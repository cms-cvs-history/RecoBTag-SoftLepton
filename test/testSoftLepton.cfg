#! /bin/env cmsRun

process SoftLeptonTag = {

    # input file
    source = PoolSource {
        untracked vstring fileNames = {
          "file:/storage/other/RelVal120pre9BJets50-120/0000/60464522-D783-DB11-9644-00304870D47B.root"
        }
        untracked int32 maxEvents = -1
    }

    # output file
    module out = PoolOutputModule {
        untracked string fileName = "file:btag_softlepton.root"
        untracked vstring outputCommands = {
            # drop all objects...
            "drop *",
            # ...but the b tag stuff...
            "keep *_jetTracksAssociator_*_*",
            "keep *_ctfWithMaterialTracks_*_*",
            "keep *_globalMuons_*_*",
            "keep *_iterativeCone5CaloJets_*_*",
            "keep *_softLeptonJetTags_*_*",
            # ...and the MC infos
            "keep *_source_*_*",
            "keep *_VtxSmeared_*_*"
        }
    }

    # Message Logger
    include "FWCore/MessageLogger/data/MessageLogger.cfi"
    replace MessageLogger.cout.threshold = "INFO"
    
    # Geometry Field, Geometry, TransientTracks
    include "MagneticField/Engine/data/volumeBasedMagneticField.cfi"
    include "Geometry/TrackerSimData/data/trackerSimGeometryXML.cfi"
    include "TrackingTools/TransientTrack/data/TransientTrackBuilder.cfi"

    # Tracks to jets association
    include "RecoBTau/JetTracksAssociator/data/jetTracksAssociator.cfi"

    # SoftLepton concrete algorithm
    es_source SoftLeptonBTagRecord = EmptyESSource {
        string recordName = "SoftLeptonBTagRecord" 
        vuint32 firstValid = { 1 }
        bool iovIsRunNotTime = true
    }
    es_module muonTaggerESProducer = MuonTaggerNoIPESProducer {
        string ComponentName = "softLeptonBTagger"
    }

    # SoftLepton b tagging
    include "RecoBTag/SoftLepton/data/softLepton.cff"

    # module execution
    path p = { jetTracksAssociator, softLeptonJetTags }

    endpath outpath = { out }
}
